# Users schema

# --- !Ups

CREATE TABLE INFO(
  ABBREV       VARCHAR(256) PRIMARY KEY NOT NULL,
  TITLE        VARCHAR(257) NOT NULL,
  LANGUAG      VARCHAR(258) NOT NULL,
  AUTHORLASTNAME  VARCHAR(259),
  AUTHORFIRSTNAME VARCHAR(260),
  YEARR        INT,
  PUBLISHER    VARCHAR(261),
  LICENSE      VARCHAR(255),
  EDITION      VARCHAR(255),
  ACCESS       VARCHAR(262),
  DISPLAYTITLE VARCHAR(255)
);

CREATE TABLE CHAPTER(
  ABBREV      VARCHAR(263) NOT NULL,
  ID          INT NOT NULL,
  TEXTT       VARCHAR(264)
);

CREATE TABLE RUBRICREMEDY(
  ABBREV      VARCHAR(265) NOT NULL,
  RUBRICID    INT NOT NULL,
  REMEDYID    INT NOT NULL,
  WEIGHT      INT NOT NULL,
  CHAPTERID   INT NOT NULL
);

CREATE TABLE REMEDY(
  ID          SERIAL UNIQUE,
  NAMEABBREV  VARCHAR(267) NOT NULL,
  NAMELONG    VARCHAR(268) NOT NULL,
  NAMEALT     VARCHAR(265)[]
);

CREATE TABLE RUBRIC(
  ABBREV      VARCHAR(270) NOT NULL,
  ID          INT NOT NULL,
  MOTHER      INT,
  ISMOTHER    BOOLEAN,
  CHAPTERID   INT NOT NULL,
  FULLPATH    VARCHAR(2048) NOT NULL,
  PATH        VARCHAR(272),
  TEXTT       VARCHAR(273)
);

CREATE TABLE FILE(
  ID          SERIAL PRIMARY KEY,
  HEADER      VARCHAR(274) NOT NULL,
  MEMBER_ID   INT NOT NULL,
  DATE_       VARCHAR(275),
  DESCRIPTION TEXT,
  CASE_IDS    INT[]
);

CREATE TABLE MEMBER(
  MEMBER_ID    INT PRIMARY KEY,
  MEMBER_NAME  VARCHAR(276) NOT NULL,
  HASH         VARCHAR(277) NOT NULL,
  REALNAME     VARCHAR(278) NOT NULL,
  EMAIL        VARCHAR(279) NOT NULL,
  COUNTRY      VARCHAR(280) NOT NULL,
  COMPANY      VARCHAR(281),
  TITLE        VARCHAR(282),
  STUDENT_UNTIL DATE,
  PROFESSION   VARCHAR(283),
  LASTSEEN     VARCHAR(255),
  NUMBEROFLOGINS INT DEFAULT 0
);

CREATE TABLE ACTIVITY(
  MEMER_ID     INT REFERENCES MEMBER(MEMBER_ID) NOT NULL,
  TIME_FROM    DATE NOT NULL,
  TIME_TO      DATE NOT NULL,
  ACCOUNT_TYPE VARCHAR(284) NOT NULL,
  AMOUNT_PAID  VARCHAR(285)
);

CREATE TABLE CAZE(
  ID           SERIAL PRIMARY KEY,
  HEADER       VARCHAR(286) NOT NULL,
  MEMBER_ID    INT NOT NULL,
  DATE_        VARCHAR(287),
  DESCRIPTION  VARCHAR(2048),
  RESULTS      INT[]
);

CREATE TABLE CAZERESULT(
  ID           SERIAL PRIMARY KEY,
  MEMBER_ID    INT NOT NULL,
  ABBREV       VARCHAR(265) NOT NULL,
  RUBRICID     INT NOT NULL,
  WEIGHT       INT NOT NULL,
  LABEL        VARCHAR(255)
);

CREATE TABLE PASSWORDCHANGEREQUEST(
  ID           VARCHAR(255) PRIMARY KEY NOT NULL,
  DATE_        VARCHAR(287) NOT NULL,
  MEMBER_ID    INT NOT NULL
);

CREATE TABLE EMAILHISTORY(
  ID           SERIAL PRIMARY KEY,
  DATE_        VARCHAR(287) NOT NULL,
  EMAIL        VARCHAR(200) NOT NULL,
  PURPOSE      VARCHAR(200)
);

CREATE TABLE mminfo(
  id           serial UNIQUE,
  abbrev       varchar(265) NOT NULL UNIQUE,
  lang         varchar(5),
  fulltitle    varchar(255),
  authorlastname  varchar(255),
  authorfirstname varchar(255),
  publisher    varchar(255),
  yearr        integer,
  license      varchar(255),
  access       varchar(262) NOT NULL,
  displaytitle varchar(255),
  PRIMARY KEY (abbrev)
);

CREATE TABLE mmchapter(
  id              serial UNIQUE,
  mminfo_id       integer REFERENCES mminfo(id),
  heading         varchar(255) NOT NULL,
  remedy_id       integer,
  PRIMARY KEY (mminfo_id, heading)
);

CREATE TABLE mmsection(
  id              serial UNIQUE,
  mmchapter_id    integer REFERENCES mmchapter(id),
  depth           integer NOT NULL,
  parent_sec_id   integer,
  succ_sec_id     integer,
  heading         varchar(265) NOT NULL,
  content         text,
  PRIMARY KEY(id)
);

# --- !Downs

DROP TABLE ACTIVITY;
DROP TABLE MEMBER;
DROP TABLE INFO;
DROP TABLE RUBRIC;
DROP TABLE REMEDY;
DROP TABLE CHAPTER;
DROP TABLE CHAPTERREMEDY;
DROP TABLE RUBRICREMEDY;
DROP TABLE FILE;
DROP TABLE CAZE;
DROP TABLE PASSWORDCHANGEREQUEST;
DROP TABLE EMAILHISTORY;
DROP TABLE mminfo;
DROP TABLE mmchapter;
DROP TABLE mmsection;

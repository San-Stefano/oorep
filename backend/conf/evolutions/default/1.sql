# Users schema

# --- !Ups

CREATE TABLE INFO(
  ABBREV       VARCHAR(255) PRIMARY KEY NOT NULL,
  TITLE        VARCHAR(255) NOT NULL,
  LANGUAG      VARCHAR(255) NOT NULL,
  AUTHORLASTNAME  VARCHAR(255),
  AUTHORFIRSTNAME VARCHAR(255),
  YEARR        INT,
  PUBLISHER    VARCHAR(255),
  EDITION      INT,
  ACCESS       VARCHAR(255)
);

CREATE TABLE CHAPTER(
  ABBREV      VARCHAR(255) NOT NULL,
  ID          INT NOT NULL,
  TEXTT       VARCHAR(255)
);

CREATE TABLE RUBRICREMEDY(
  ABBREV      VARCHAR(255) NOT NULL,
  RUBRICID    INT NOT NULL,
  REMEDYID    INT NOT NULL,
  WEIGHT      INT NOT NULL,
  CHAPTERID   INT NOT NULL
);

CREATE TABLE REMEDY(
  ABBREV      VARCHAR(255) NOT NULL,
  ID          INT NOT NULL,
  NAMEABBREV  VARCHAR(10) NOT NULL,
  NAMELONG    VARCHAR(40) NOT NULL
);

CREATE TABLE CHAPTERREMEDY(
  ABBREV      VARCHAR(255) NOT NULL,
  REMEDYID    INT NOT NULL,
  CHAPTERID   INT NOT NULL
);

CREATE TABLE RUBRIC(
  ABBREV      VARCHAR(255) NOT NULL,
  ID          INT NOT NULL,
  MOTHER      INT,
  ISMOTHER    BOOLEAN,
  CHAPTERID   INT NOT NULL,
  FULLPATH    VARCHAR(255) NOT NULL,
  PATH        VARCHAR(255),
  TEXTT       VARCHAR(255)
);

CREATE TABLE FILE(
  ID          SERIAL PRIMARY KEY,
  HEADER      VARCHAR(255) NOT NULL,
  MEMBER_ID   INT NOT NULL,
  DATE_       VARCHAR(40),
  DESCRIPTION VARCHAR(2048),
  CASE_IDS    INT[]
);

CREATE TABLE MEMBER(
  MEMBER_ID    INT         PRIMARY KEY NOT NULL,
  MEMBER_NAME  VARCHAR(255) NOT NULL,
  HASH         VARCHAR(255) NOT NULL,
  REALNAME     VARCHAR(255) NOT NULL,
  EMAIL        VARCHAR(255) NOT NULL,
  COUNTRY      VARCHAR(255) NOT NULL,
  COMPANY      VARCHAR(255),
  TITLE        VARCHAR(255),
  STUDENT_UNTIL DATE,
  PROFESSION   VARCHAR(255)
);

CREATE TABLE ACTIVITY(
  MEMER_ID     INT         REFERENCES MEMBER(MEMBER_ID) NOT NULL,
  TIME_FROM    DATE        NOT NULL,
  TIME_TO      DATE        NOT NULL,
  ACCOUNT_TYPE VARCHAR(255) NOT NULL,
  AMOUNT_PAID  VARCHAR(255)
);

-- https://stackoverflow.com/questions/14225397/postgresql-insert-an-array-of-composite-type-containing-arrays
-- CREATE TYPE WEIGHTEDREMEDY AS (REMEDY_ID INT, WEIGHT INT);

-- WORKS: insert into caserubric VALUES (  ROW(0, NULL, NULL, 0, 'FP', NULL, NULL), 'kent', 1, ARRAY[ROW(1,1)::WEIGHTEDREMEDY]  );
--CREATE TYPE CASERUBRIC AS (
--   RUBRIC_         RUBRIC,
--   REPERTORYABBREV VARCHAR(40),
--   RUBRICWEIGHT    INT,
--   WEIGHTEDREMEDIES WEIGHTEDREMEDY[]
--);

CREATE TABLE CAZE(
  ID           SERIAL PRIMARY KEY,
  HEADER       VARCHAR(255) NOT NULL,
  MEMBER_ID    INT NOT NULL,
  DATE_        VARCHAR(40),
  DESCRIPTION  VARCHAR(2048),
  RESULTS      TEXT NOT NULL
--  RESULTS      CASERUBRIC[] NOT NULL
);

# --- !Downs

DROP TABLE ACTIVITY;
DROP TABLE MEMBER;
DROP TABLE INFO;
DROP TABLE RUBRIC;
DROP TABLE REMEDY;
-- DROP TYPE CASERUBRIC;
-- DROP TYPE WEIGHTEDREMEDY;
DROP TABLE FILE;
DROP TABLE CAZE;
